<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <div th:replace="fragment/fragment :: myheader"></div>
    <link type="text/css" href="/css/allmatiere.css" rel="stylesheet" />

</head>
<body>
<!--header-->
<header th:replace="fragment/fragment :: myheadera"></header>

<main class="container mt-5">

    <aside th:replace="fragment/fragment :: leftaside"></aside>
        <section>
            <!-- Form to add a new Matiere -->
            <div>
                <form th:action="@{/matieres/add}" method="post">
                    <input type="text" name="titrem" placeholder="Titre de la Matiere" required />
                    <button type="submit">Ajouter Matiere</button>
                </form>
            </div>

            <!-- Existing code to display matieres and their details -->

                <!-- Existing code for Matieres -->
                <div th:each="matiere : ${matieres}">
                    <div class="matiere-box background" th:onclick="'toggleDetails(' + ${matiere.id} + ')'" th:text="${matiere.titrem}"></div>
                    <!-- Delete Matiere -->
                    <form th:action="@{/matieres/delete/{matiereId}(matiereId=${matiere.id})}" th:method="post">
                        <input type="hidden" name="_method" value="delete" />
                        <button type="submit" onclick="return confirm('Are you sure you want to delete this matiere and all its chapters?');">Delete Matiere</button>
                    </form>

                    <div class="chapitres-details" th:id="'details-' + ${matiere.id}">
                        <ul>
                            <li th:each="chapitre, chapterStat : ${matiere.chapitres}">
                    <span class="chapitre-box">
                        Chapter <span th:text="${chapterStat.index + 1}"></span>: <span th:text="${chapitre.titre}"></span>
                        <!-- Delete Chapitre -->
                        <form th:action="@{/chapitres/delete/{chapitreId}(chapitreId=${chapitre.id})}" th:method="post">
                            <input type="hidden" name="_method" value="delete" />
                            <button type="submit" onclick="return confirm('Are you sure you want to delete this chapitre?');">Delete</button>
                        </form>
                    </span>
                                <ul>
                                    <!-- Existing code for displaying Cours -->
                                    <li th:each="cour, courStat : ${chapitre.cours}">
                                        <a class="cour-box" th:href="@{${cour.filePath}}" download>
                                            Cour <span th:text="${courStat.index + 1}"></span>: <span th:text="${cour.title}"></span>
                                        </a>
                                        <form th:action="@{/cours/delete/{courid}(courid=${cour.id})}" th:method="post">
                                            <input type="hidden" name="_method" value="delete" />
                                            <button type="submit" onclick="return confirm('Are you sure you want to delete this cour?');">Delete</button>
                                        </form>
                                    </li>
                                    <!-- Add Cour to Chapitre -->
                                    <li>
                                        <button th:onclick="'showAddCourForm(' + ${chapitre.id} + ')'">Ajouter Cour</button>
                                        <div th:id="'add-cour-form-' + ${chapitre.id}" style="display: none;">
                                            <form th:action="@{/cours/add}" method="post" enctype="multipart/form-data">
                                                <input type="hidden" name="chapitreId" th:value="${chapitre.id}" />
                                                <input type="text" name="courTitle" placeholder="Titre du Cour" />
                                                <input type="file" name="file" />
                                                <button type="submit">Ajouter</button>
                                            </form>
                                        </div>
                                    </li>
                                    <!-- Add TP to Chapitre -->
                                    <li>
                                        <button th:onclick="'showAddTpForm(' + ${chapitre.id} + ')'">Ajouter TP</button>
                                        <div th:id="'add-tp-form-' + ${chapitre.id}" style="display: none;">
                                            <form th:action="@{/tp/add}" method="post">
                                                <input type="hidden" name="chapitreId" th:value="${chapitre.id}" />
                                                <input type="text" name="tpTitle" placeholder="Titre du TP" />
                                                <button type="submit">Ajouter</button>
                                            </form>
                                        </div>
                                    </li>
                                    <!-- Add TD to Chapitre -->
                                    <li>
                                        <button th:onclick="'showAddTdForm(' + ${chapitre.id} + ')'">Ajouter TD</button>
                                        <div th:id="'add-td-form-' + ${chapitre.id}" style="display: none;">
                                            <form th:action="@{/td/add}" method="post">
                                                <input type="hidden" name="chapitreId" th:value="${chapitre.id}" />
                                                <input type="text" name="tdTitle" placeholder="Titre du TD" />
                                                <button type="submit">Ajouter</button>
                                            </form>
                                        </div>
                                    </li>
                                </ul>
                            </li>
                        </ul>
                        <button th:onclick="'showAddChapterForm(' + ${matiere.id} + ')'">Ajouter Chapitre</button>
                        <div th:id="'add-chapter-form-' + ${matiere.id}" style="display: none;">
                            <form th:action="@{/chapitres/addChapter}" method="post">
                                <input type="hidden" name="matiereId" th:value="${matiere.id}" />
                                <input type="text" name="chapterTitle" placeholder="Titre du Chapitre" />
                                <button type="submit">Ajouter</button>
                            </form>
                        </div>
                    </div>
                </div>


        </section>


    <aside>
        <div  class="right-aside">
            <div class="question-box">
                <h3 style="color:#FFDAB9">Recent Questions</h3>
                <div th:each="question, iterStat : ${questions}" th:if="${iterStat.index >= iterStat.size - 6}" class="mini-question">
                    <a th:href="@{/question/question/{id}/edit(id=${question.id})}" th:text="${question.titreq}"></a>
                </div>




            </div>
            <br><br><br>
            <div>
                <p>Total Questions: {{ totalQuestions }}</p>
                <p>Total Users: {{ totalUsers }}</p>
                <br><br>
                <p>Our enterprise forum facilitates seamless collaboration, offering a centralized platform for team members to engage in open discussions and share valuable insights. This streamlined communication enhances teamwork and contributes to a more cohesive work environment</p>
                <br>
                <p>Acting as an efficient information hub, the forum enables swift exchange of updates and project details. This accessibility ensures that everyone stays well-informed, fostering a culture of transparency and agility within the organization.</p>
                <br>
                <p>A special thank you to each participant for making this forum a dynamic space. Your active involvement has contributed to creating a vibrant community that encourages innovation and knowledge sharing. Together, we continue to build a valuable resource for our collective success.</p>
            </div>
        </div>

    </aside>
</main>
<!--footer-->
<footer th:replace="fragment/fragment :: footer"></footer>



<script>
        function toggleDetails(id) {
            var details = document.getElementById('details-' + id);
            if (details.style.display === 'none' || details.style.display === '') {
                details.style.display = 'block';
            } else {
                details.style.display = 'none';
            }
        }
    </script>

<script>
document.addEventListener('DOMContentLoaded', () => {
    const images = [


        '../imgs/3.jpg',
        '../imgs/5.jpg',
        '../imgs/6.jpg',
        '../imgs/7.jpg',
        '../imgs/8.jpg',
        '../imgs/9.jpg',
        '../imgs/10.jpg',
        // Add more image paths as needed
    ];

    const elements = document.querySelectorAll('.background');
    const usedImages = new Set();

    elements.forEach(element => {
        let randomImage;
        do {
            randomImage = images[Math.floor(Math.random() * images.length)];
        } while (usedImages.has(randomImage) && usedImages.size < images.length);

        usedImages.add(randomImage);
        element.style.backgroundImage = `url('${randomImage}')`;
    });
});
    </script>

<script>
    function showAddChapterForm(matiereId) {
        document.getElementById('add-chapter-form-' + matiereId).style.display = 'block';
    }
</script>

<script>
 function showAddTdForm(chapitreId) {
    var formId = 'add-td-form-' + chapitreId;
    var form = document.getElementById(formId);
    if (form.style.display === 'none') {
        form.style.display = 'block';
    } else {
        form.style.display = 'none';
    }
}

function showAddTpForm(chapitreId) {
    var formId = 'add-tp-form-' + chapitreId;
    var form = document.getElementById(formId);
    if (form.style.display === 'none') {
        form.style.display = 'block';
    } else {
        form.style.display = 'none';
    }
}

function showAddCourForm(chapitreId) {
    var formId = 'add-cour-form-' + chapitreId;
    var form = document.getElementById(formId);
    if (form.style.display === 'none') {
        form.style.display = 'block';
    } else {
        form.style.display = 'none';
    }
}


</script>


</body>
</html>